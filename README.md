# 河北旅游问答智能体

**Hebei Travel QA Agent（Local-Knowledge-Driven RAG System）**

---

## 1. 项目简介

本项目实现了一个**面向河北省旅游场景的智能问答系统**，用于支持景点查询、行程规划、费用参考与出行决策等典型旅游问题。

与“直接调用大模型”的聊天机器人不同，本系统采用 **RAG（Retrieval-Augmented Generation，检索增强生成）** 架构，并坚持 **“本地知识决策优先”** 的核心设计原则：

> **所有事实型信息，必须来自本地知识库；
> 大模型（如 UniAPI / DeepSeek）仅作为“语言表达增强层”，不参与任何知识决策。**

因此，本系统在**可解释性、可控性与工程完整性**方面，显著区别于普通大模型应用。

---

### 核心设计理念

* **知识可控**：所有答案可追溯至本地知识条目
* **系统可解释**：每次回答可展示 Top-K 命中证据
* **模型可替换**：系统本身不依赖具体大模型
* **运行可离线**：在不接入任何外部 API 的情况下，系统仍可完整运行

---

### 系统能力概览

* 📚 基于 **本地 TXT 知识库**
* 🔎 使用 **FAISS 向量数据库**进行语义检索
* 🧠 支持 **多轮对话上下文理解**
* 🧩 支持 **可选大模型语言增强（UniAPI / DeepSeek）**
* 🖥 提供 **可视化 Streamlit UI**
* 📎 UI 中清晰标注 **当前回答模式（本地 / UniAPI）**

---

## 2. 系统总体架构

系统采用“**离线构建 + 在线检索 + 可选增强 + UI 展示**”的分层架构：

```
hebei_knowledge.txt
        ↓
本地 Embedding 计算
        ↓
FAISS 向量库（faiss_hebei）
        ↓
用户问题（UI / CLI）
        ↓
FAISS Top-K 语义检索（决策层）
        ↓
基于知识库生成回答
        ↓
（可选）UniAPI / DeepSeek 语言润色
        ↓
UI 展示（回答 + 检索证据 + 模式标注）
```

> **重要说明**
>
> * 即使完全不接入任何大模型 API，本系统仍是一个**完整可运行的智能体系统**
> * 接入大模型仅提升“表达质量”，不影响“事实正确性”

---

## 3. 知识库设计（TXT → 结构化语义单元）

### 3.1 知识库来源

系统所有知识均来自本地文件：

```
hebei_knowledge.txt
```

覆盖内容包括：

* 景点信息（门票 / 交通 / 游览建议 / 避坑）
* 美食推荐
* 行程规划（亲子 / 老人 / 情侣 / 深度游）
* 实用信息（预约方式 / 天气 / 住宿 / 出行建议）

---

### 3.2 知识条目结构规范

每条知识采用统一结构，便于解析与向量化：

```text
【类型】景点
【城市】唐山遵化
【名称】清东陵
【内容】……
```

不同知识块之间使用：

```text
---
```

作为分隔符。

---

### 3.3 结构化解析与元数据

构建向量库时：

* 以 `---` 作为最小语义单元
* 每个知识块映射为一个 `Document`
* 自动抽取并写入 metadata：

  * `type`（知识类型）
  * `city`（城市）
  * `name`（名称）
  * `title`（UI 与证据展示用）

---

## 4. 向量化与检索模块

### 4.1 Embedding 模型

系统采用本地多语言语义向量模型：

```
sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
```

模型特性：

* 支持中文
* 完全离线运行
* 无 API Key / 无调用成本
* 满足旅游领域语义检索精度需求

---

### 4.2 本地 Embedding 封装

系统实现 `LocalEmbeddings` 类，兼容 LangChain 接口：

```python
class LocalEmbeddings(Embeddings):
    def embed_documents(self, texts): ...
    def embed_query(self, text): ...
```

实现功能：

* 文档向量化
* 查询向量化
* FAISS 检索适配

---

### 4.3 FAISS 向量库构建

构建流程：

1. 解析 `hebei_knowledge.txt`
2. 构建 `Document` 列表
3. 本地计算向量表示
4. FAISS 建立索引
5. 本地持久化保存

输出目录：

```
faiss_hebei/
```

构建脚本：

```
build_faiss_hebei.py
```

---

## 5. 在线问答与多轮对话机制

### 5.1 RAG 检索增强逻辑

每次用户提问，系统执行：

1. 接收当前问题
2. 拼接最近多轮对话上下文
3. FAISS Top-K 语义检索
4. 业务规则过滤（如泛“城市-*”条目）
5. 命中结果作为**唯一知识依据**

---

### 5.2 多轮对话记忆

* 每个用户分配独立 `user_id`
* 默认保留最近 3 轮问答
* 用于理解省略与指代问题
  （如“怎么去”“多少钱”“第二天呢”）

---

## 6. 大模型接入策略（UniAPI / DeepSeek，可选）

### 6.1 设计原则

* ❌ 大模型 **不参与检索**
* ❌ 大模型 **不参与事实决策**
* ✅ 仅用于 **语言组织与表达优化**
* ✅ 可随时在 UI 中开启 / 关闭

---

### 6.2 支持模式对比

| 模式          | 知识来源  | 决策层        | 生成层   |
| ----------- | ----- | ---------- | ----- |
| 本地模式（默认）    | 本地知识库 | FAISS + 规则 | 本地生成  |
| UniAPI 增强模式 | 本地知识库 | FAISS + 规则 | 大模型润色 |

---

### 6.3 UI 可解释性设计

在 UI 中明确标注：

* 📘 当前回答：**本地知识库驱动**
* 🧠 当前回答：**已启用 UniAPI 语言增强（仅润色）**

---

## 7. 用户界面（Streamlit）

### 功能特点

* 聊天式交互体验
* 示例问题快速触发
* 会话状态管理
* 检索证据可截图展示
* 回答模式状态提示
* 一键清空对话

---

### 启动方式

```bash
streamlit run ui_app.py
```

或：

```bash
python run_ui.py
```

---

## 8. 项目结构

```text
Hebei-Travel-Agent/
├── hebei_knowledge.txt        # 本地知识库
├── build_faiss_hebei.py       # 向量库构建脚本
├── faiss_hebei/               # FAISS 索引
├── hebei_agent_faiss_main.py  # 智能体核心逻辑
├── ui_app.py                  # UI
├── run_ui.py                  # 一键启动
├── README.md                  # 项目说明
└── .venv/
```

---

## 9. 项目定位总结

> **这是一个“以本地知识为核心决策单元、以大模型为可选表达层”的旅游智能体系统。**


